#:kivy 1.11.1

<ModbusConfig>:
    title: "MODBUS - Ip, Porta e Scan Time test"
    size_hint_x: 0.3
    size_hint_y: None
    height: 225
    BoxLayout:
        id: md_modbus_config
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 3
            Label:
                text: "Ip Esteira"
            TextInput:
                id: input_ip
                halign: 'center'
            Label:
                text: "Porta Esteira"
            TextInput:
                id: input_porta
                halign: 'center'
            Label:
                text: "Scan Time [ms]"
            TextInput:
                id: input_scantime
                halign: 'center'
        BoxLayout:
            size_hint:(1, 0.35)
            orientation: 'horizontal'
            Button:
                height: 10
                id: bt_modbusconfig_md_scantime
                text: "Definir Scan Time"
                on_release: app.root.set_modbus_scan_time(int(input_scantime.text))
        BoxLayout:
            size_hint:(1, 0.35)
            orientation: 'horizontal'
            Button:
                height: 10
                id: bt_modbusconfig_md_conectar
                text: "Conectar"
                on_release: app.root.create_modbus_connection(str(input_ip.text), int(input_porta.text), int(input_scantime.text))
            Button:
                height: 10
                id: bt_modbusconfig_md_desconectar
                text: "Desconectar"
                on_release: app.root.close_modbus_connection()
            Button:
                height: 10
                id: bt_modbusconfig_md_cancelar
                text: "Cancelar"
                on_release:
                    root.limpar_dados()
                    root.dismiss()

<ModalTensao>:
    title: "Tensão Entre os Rolamentos"
    size_hint_x: 0.2
    size_hint_y: None
    height: 400
    BoxLayout:
        id: md_tensao_config
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 3
            Label:
                text: "Tensão RS:"
            Label:
                id: lb_tens_rs
                text: "N/a [V]"
            Label:
                text: "Tensão ST:"
            Label:
                id: lb_tens_st
                text: "N/a [V]"
            Label:
                text: "Tensão TR:"
            Label:
                id: lb_tens_tr
                text: "N/a [V]"
        BoxLayout:
            size_hint_y: 0.2
            Button:
                height: 10
                id: bt_tensao_md_cancelar
                text: "Fechar"
                on_release:
                    root.dismiss()

<ModalCorrente>:
    title: "Correntes do Motor"
    size_hint_x: 0.2
    size_hint_y: None
    height: 600
    BoxLayout:
        id: md_corrente_config
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 5
            Label:
                text: "Corrente R:"
            Label:
                id: lb_curr_r
                text: "N/a [A]"
            Label:
                text: "Corrente S:"
            Label:
                id: lb_curr_s
                text: "N/a [A]"
            Label:
                text: "Corrente T:"
            Label:
                id: lb_curr_t
                text: "N/a [A]"
            Label:
                text: "Corrente N:"
            Label:
                id: lb_curr_N
                text: "N/a [A]"
            Label:
                text: "Corrente Média:"
            Label:
                id: lb_curr_med
                text: "N/a [A]"
        BoxLayout:
            size_hint_y: 0.2
            Button:
                height: 10
                id: bt_corrente_md_cancelar
                text: "Fechar"
                on_release:
                    root.dismiss()

<ModalPotencia>:
    title: "Potencia do Motor"
    size_hint_x: 0.7
    size_hint_y: None
    height: 600
    BoxLayout:
        id: md_corrente_config
        orientation: 'vertical'
        GridLayout:
            cols: 6
            rows: 4
            Label:
                text: "Potencia Ativa R:"
            Label:
                id: lb_pot_ativ_r
                text: "N/a [P]"
            Label:
                text: "Potencia Reativa R:"
            Label:
                id: lb_pot_reativ_r
                text: "N/a [VAR]"
            Label:
                text: "Potencia Aparente R:"
            Label:
                id: lb_pot_apar_r
                text: "N/a [VA]"
            Label:
                text: "Potencia Ativa S:"
            Label:
                id: lb_pot_ativ_s
                text: "N/a [P]"
            Label:
                text: "Potencia Reativa S:"
            Label:
                id: lb_pot_reativ_s
                text: "N/a [VAR]"
            Label:
                text: "Potencia Aparente S:"
            Label:
                id: lb_pot_apar_s
                text: "N/a [VA]"
            Label:
                text: "Potencia Ativa T:"
            Label:
                id: lb_pot_ativ_t
                text: "N/a [P]"
            Label:
                text: "Potencia Reativa T:"
            Label:
                id: lb_pot_reativ_t
                text: "N/a [VAR]"
            Label:
                text: "Potencia Aparente T:"
            Label:
                id: lb_pot_apar_t
                text: "N/a [VA]"
            Label:
                text: "Potencia Ativa Total:"
            Label:
                id: lb_pot_ativ_total
                text: "N/a [P]"
            Label:
                text: "Potencia Reativa Total:"
            Label:
                id: lb_pot_reativ_total
                text: "N/a [VAR]"
            Label:
                text: "Potencia Aparente Total:"
            Label:
                id: lb_pot_apar_total
                text: "N/a [VA]"
        BoxLayout:
            size_hint_y: 0.2
            Button:
                height: 10
                id: bt_Potencia_md_cancelar
                text: "Fechar"
                on_release:
                    root.dismiss()

<ModalTemperatura>:
    title: "Temperaturas do Motor"
    size_hint_x: 0.3
    size_hint_y: None
    height: 600
    BoxLayout:
        id: md_corrente_config
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 5
            Label:
                text: "Temperatura R:"
            Label:
                id: lb_temp_r
                text: "N/a [C°]"
            Label:
                text: "Temperatura S:"
            Label:
                id: lb_temp_s
                text: "N/a [C°]"
            Label:
                text: "Temperatura T:"
            Label:
                id: lb_temp_t
                text: "N/a [C°]"
            Label:
                text: "Temperatura da Carcaça:"
            Label:
                id: lb_temp_carc
                text: "N/a [C°]"
        BoxLayout:
            size_hint_y: 0.2
            Button:
                height: 10
                id: bt_temperatura_md_cancelar
                text: "Fechar"
                on_release:
                    root.dismiss()

<ModalAcionamento>
    title: "Acionamento do Motor"
    size_hint_x: 0.6
    size_hint_y: 0.3
    height: 600
    BoxLayout:
        orientation: 'horizontal'
        GridLayout:
            size_hint: (0.35, 1)
            cols: 1
            rows: 3
            Button:
                id: bt_motor_start
                text: "Ligar Motor"
                on_release: app.root.start_motor()
            Button:
                id: bt_motor_stop
                text: "Desligar Motor"
                on_release: app.root.stop_motor()
            Button:
                id: bt_motor_reset
                text: "Reseta Motor"
                on_release: app.root.reset_motor()
        GridLayout:
            size_hint: (0.35, 1)
            cols: 1
            rows: 4
            Label:
                text: "Tipo de Partida"
            Button:
                id: bt_partida_direta
                text: "TESYS DIRETA"
                on_release: app.root.set_tipo_partida(0)
            Button:
                id: bt_partida_inversor
                text: "ATV31 INVERSOR"
                on_release: app.root.set_tipo_partida(2)
            Button:
                id: bt_partida_soft
                text: "ATS58 SOFT-START"
                on_release: app.root.set_tipo_partida(1)
        BoxLayout:
            orientation: "vertical"
            size_hint: (0.35, 1)
            Label:
                size_hint: (1, 0.3)
                id: lb_driver_partida
                text: "Escolha um tipo de Partida..."
            GridLayout:
                cols: 2
                rows: 2
                Label:
                    text: "Aceleração [s]"
                TextInput:
                    id: input_aceleracao
                    halign: 'center'
                    input_filter: "int"
                    multiline: False
                    text: str(10)
                Label:
                    text: "Desaceleração [s]"
                TextInput:
                    id: input_desaceleracao
                    halign: 'center'
                    input_filter: "int"
                    multiline: False
                    text: str(10)
            BoxLayout:
                size_hint: (1, 0.6)
                orientation: 'vertical'
                BoxLayout:
                    orientation: 'horizontal'
                    Label:
                        text: ("Frequencia [HZ]:")
                    Label:
                        text: str(slider_freq.value)
                Slider:
                    id: slider_freq
                    min: 0
                    max: 60
                    step: 1
                    value: 60
                    orientation: 'horizontal'

<ModalPID>
    title: "Controle de PID"
    size_hint_x: 0.6
    size_hint_y: 0.3
    height: 600
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            GridLayout:
                size_hint: (0.35, 1)
                cols: 4
                rows: 3
                Label:
                    text: "PID Automatico?"
                CheckBox:
                    id: input_pid_automatico
                    active: True
                Label:
                    text: "P"
                TextInput:
                    id: input_pid_p
                    halign: 'center'
                    input_filter: "float"
                    multiline: False
                    text: str(10)
                Label:
                    text: "Set Point PID (SP)"
                TextInput:
                    id: input_pid_sp
                    halign: 'center'
                    input_filter: "float"
                    multiline: False
                    text: str(30)
                Label:
                    text: "I"
                TextInput:
                    id: input_pid_i
                    halign: 'center'
                    input_filter: "float"
                    multiline: False
                    text: str(0.2)
                Label:
                    text: "Variável Manipulada (MV)"
                TextInput:
                    id: input_pid_mv
                    halign: 'center'
                    input_filter: "float"
                    multiline: False
                    text: str(30)
                Label:
                    text: "D"
                TextInput:
                    id: input_pid_d
                    halign: 'center'
                    input_filter: "float"
                    multiline: False
                    text: str(1)
        BoxLayout:
            size_hint: (1, 0.2)
            Button:
                id: bt_pid_atualizar
                text: "Atualizar Dados de PID"

<HistGraphPopup>:
    title: "Histórico dos sensores"
    BoxLayout:
        orientation:'vertical'
        TimeSeriesGraph:
            id: graph
            xlabel: 'Amostras'
            ylabel: 'Labely'
            background_color:0.5,0.5,0.5,0.5
            x_ticks_minor: 1
            x_ticks_major: 5
            y_ticks_major: 100
            x_grid_label: True
            y_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin:0
            ymin:0
            ymax:500
        BoxLayout:
            id:sensores
            orientation:'horizontal'
            size_hint: (1,0.1)
        BoxLayout:
            orientation:'horizontal'
            size_hint:(1,0.1)
            Label:
                text:'Timestamp inicial \r\n [size=12] (DD/MM/AAAA HH:MM :SS) [/size]'
                halign: 'center'
                markup: True
            TextInput:
                id:txt_init_time
                size_hint: (1,0.8)
                halign:'center'
                valign:'middle'
                multiline: False
            Label:
                text:'Timestamp final \r\n [size=12] (DD/MM/AAAA HH:MM :SS) [/size]'
                halign: 'center'
                markup: True            
            TextInput:
                id:txt_final_time
                size_hint: (1,0.8)
                halign:'center'
                valign:'middle'
                multiline: False
            Button:
                text:"Fechar"
                size_hint: (1,0.8)
                on_release: root.dismiss()

<LabeledCheckBoxHistGraph>:
    orientaiton:'horizontal'
    size_hint:(0.05,1)
    CheckBox:
        id:checkbox
        on_active: app.root.getDataDB()
    Label:
        id:label
        font_size: 12
        bold: True
        
<DataGraphPopupRPM>:
    title: "Gráfico em tempo real"
    BoxLayout:
        orientation: 'vertical'
        TimeSeriesGraph:
            id: graphrpm
            xlabel: 'Horário'
            ylabel: 'RPM'
            background_color: 0.5,0.5,0.5,0.5
            x_ticks_minor: 1
            x_ticks_major: 5
            y_ticks_major: 100
            y_grid_label: True
            x_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin:0
            ymin:0
            ymax:2000
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.05)
            BoxLayout:
                orientation: 'horizontal'
                size_hint: (0.5,1)
                Label:
                    size_hint: (0.3,1)
                    text: "Número de pontos do gráfico"
                LabeledCheckBoxGraphRPM:
                    id: mp20
                    on_kv_post:
                        self.ids.label.text = '20'
                        self.ids.checkbox.group = 'cb_group'
                LabeledCheckBoxGraphRPM:
                    id: mp50
                    on_kv_post:
                        self.ids.label.text = '50'
                        self.ids.checkbox.group = 'cb_group'
                LabeledCheckBoxGraphRPM:
                    id: mp100
                    on_kv_post:
                        self.ids.label.text = '100'
                        self.ids.checkbox.group = 'cb_group'
            Button:
                text: "Fechar"
                size_hint: (0.2,1)
                on_release: root.dismiss()

<LabeledCheckBoxGraphRPM>:
    orientation: 'horizontal'
    size_hint: (0.1,1)
    CheckBox:
        id: checkbox
        on_active: app.root._graphrpm.ids.graphrpm.setMaxPoints(int(label.text),0) if app.root is not None else None
    Label:
        id: label
        

<DataGraphPopupVEL>:
    title: "Gráfico em tempo real da velocidade da esteira"
    BoxLayout:
        orientation: 'vertical'
        TimeSeriesGraph:
            id: graphvel
            xlabel: 'Horário'
            ylabel: 'm/s'
            background_color: 0.5,0.5,0.5,0.5
            x_ticks_minor: 1
            x_ticks_major: 5
            y_ticks_major: 1
            y_grid_label: True
            x_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin:0
            ymin:0
            ymax:10
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.05)
            BoxLayout:
                orientation: 'horizontal'
                size_hint: (0.5,1)
                Label:
                    size_hint: (0.3,1)
                    text: "Número de pontos do gráfico"
                LabeledCheckBoxGraphVEL:
                    id: 2mp20
                    on_kv_post:
                        self.ids.label.text = '20'
                        self.ids.checkbox.group = 'cb2_group'
                LabeledCheckBoxGraphVEL:
                    id: 2mp50
                    on_kv_post:
                        self.ids.label.text = '50'
                        self.ids.checkbox.group = 'cb2_group'
                LabeledCheckBoxGraphVEL:
                    id: 2mp100
                    on_kv_post:
                        self.ids.label.text = '100'
                        self.ids.checkbox.group = 'cb2_group'
            Button:
                text: "Fechar"
                size_hint: (0.2,1)
                on_release: root.dismiss()

<LabeledCheckBoxGraphVEL>:
    orientation: 'horizontal'
    size_hint: (0.1,1)
    CheckBox:
        id: checkbox
        on_active: app.root._graphvel.ids.graphvel.setMaxPoints(int(label.text),0) if app.root is not None else None
    Label:
        id: label
        
<DataGraphPopupTOR>:
    title: "Gráfico em tempo real do torque no motor"
    BoxLayout:
        orientation: 'vertical'
        TimeSeriesGraph:
            id: graphtor
            xlabel: 'Horário'
            ylabel: 'm/s'
            background_color: 0.5,0.5,0.5,0.5
            x_ticks_minor: 1
            x_ticks_major: 5
            y_ticks_major: 0.1
            y_grid_label: True
            x_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin:0
            ymin:0
            ymax:1
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.05)
            BoxLayout:
                orientation: 'horizontal'
                size_hint: (0.5,1)
                Label:
                    size_hint: (0.3,1)
                    text: "Número de pontos do gráfico"
                LabeledCheckBoxGraphTOR:
                    id: 3mp20
                    on_kv_post:
                        self.ids.label.text = '20'
                        self.ids.checkbox.group = 'cb3_group'
                LabeledCheckBoxGraphTOR:
                    id: 3mp50
                    on_kv_post:
                        self.ids.label.text = '50'
                        self.ids.checkbox.group = 'cb3_group'
                LabeledCheckBoxGraphTOR:
                    id: 3mp100
                    on_kv_post:
                        self.ids.label.text = '100'
                        self.ids.checkbox.group = 'cb3_group'
            Button:
                text: "Fechar"
                size_hint: (0.2,1)
                on_release: root.dismiss()

<LabeledCheckBoxGraphTOR>:
    orientation: 'horizontal'
    size_hint: (0.1,1)
    CheckBox:
        id: checkbox
        on_active: app.root._graphtor.ids.graphtor.setMaxPoints(int(label.text),0) if app.root is not None else None
    Label:
        id: label
        